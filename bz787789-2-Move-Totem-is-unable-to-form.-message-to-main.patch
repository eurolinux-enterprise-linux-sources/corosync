From e032c14341c38be4d273093f1e6691f8417e264d Mon Sep 17 00:00:00 2001
From: Jan Friesse <jfriesse@redhat.com>
Date: Mon, 8 Oct 2012 17:07:39 +0200
Subject: [PATCH] Move "Totem is unable to form..." message to main

Signed-off-by: Jan Friesse <jfriesse@redhat.com>
Reviewed-by: Fabio M. Di Nitto <fdinitto@redhat.com>
(backported to flatiron)
---
 exec/main.c     |    8 ++++++++
 exec/totemsrp.c |    8 --------
 2 files changed, 8 insertions(+), 8 deletions(-)

diff --git a/exec/main.c b/exec/main.c
index dd0ff99..a2a9725 100644
--- a/exec/main.c
+++ b/exec/main.c
@@ -646,6 +646,14 @@ static void corosync_totem_stats_updater (void *data)
 		"firewall_enabled_or_nic_failure", strlen("firewall_enabled_or_nic_failure"),
 		&firewall_enabled_or_nic_failure, sizeof (firewall_enabled_or_nic_failure));
 
+	if (stats->mrp->srp->continuous_gather > MAX_NO_CONT_GATHER) {
+		log_printf (LOGSYS_LEVEL_WARNING,
+			"Totem is unable to form a cluster because of an "
+			"operating system or network fault. The most common "
+			"cause of this message is that the local firewall is "
+			"configured improperly.");
+	}
+
 	total_mtt_rx_token = 0;
 	total_token_holdtime = 0;
 	total_backlog_calc = 0;
diff --git a/exec/totemsrp.c b/exec/totemsrp.c
index 67de157..c0cfda5 100644
--- a/exec/totemsrp.c
+++ b/exec/totemsrp.c
@@ -1929,14 +1929,6 @@ static void memb_state_gather_enter (
 		instance->stats.continuous_gather++;
 	}
 
-	if (instance->stats.continuous_gather > MAX_NO_CONT_GATHER) {
-		log_printf (instance->totemsrp_log_level_warning,
-			"Totem is unable to form a cluster because of an "
-			"operating system or network fault. The most common "
-			"cause of this message is that the local firewall is "
-			"configured improperly.\n");
-	}
-
 	return;
 }
 
-- 
1.7.1

