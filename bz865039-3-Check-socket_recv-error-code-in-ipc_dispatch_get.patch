From 694a9c2cf0804428671bf815b974a080c7fd1c6c Mon Sep 17 00:00:00 2001
From: Jan Friesse <jfriesse@redhat.com>
Date: Thu, 6 Dec 2012 10:51:01 +0100
Subject: [PATCH] Check socket_recv error code in ipc_dispatch_get

Also do not assert on error.

Signed-off-by: Jan Friesse <jfriesse@redhat.com>
Reviewed-by: Fabio M. Di Nitto <fdinitto@redhat.com>
---
 lib/coroipcc.c |    9 ++-------
 1 files changed, 2 insertions(+), 7 deletions(-)

diff --git a/lib/coroipcc.c b/lib/coroipcc.c
index 30b1474..3ad4921 100644
--- a/lib/coroipcc.c
+++ b/lib/coroipcc.c
@@ -908,14 +908,9 @@ coroipcc_dispatch_get (
 	}
 
 	error = socket_recv (ipc_instance->fd, &buf, 1);
-#if defined(COROSYNC_SOLARIS) || defined(COROSYNC_BSD) || defined(COROSYNC_DARWIN)
-	/* On many OS poll() never returns POLLHUP or POLLERR.
-	 * EOF is detected when recvmsg() return 0.
-	 */
-	if ( error == CS_ERR_LIBRARY )
+	if (error != CS_OK) {
 		goto error_put;
-#endif
-	assert (error == CS_OK);
+	}
 
 	if (shared_mem_dispatch_bytes_left (ipc_instance) > (ipc_instance->dispatch_size/2)) {
 		/*
-- 
1.7.1

